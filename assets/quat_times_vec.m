function V = quat_times_vec(q,v)
% V = RodriguesQuaternion(q)*v 
% q : 4 x N
% v : 3 x N
% V : 3 x N
v1 = v(1,:);
v2 = v(2,:);
v3 = v(3,:);
q1 = q(1,:);
q2 = q(2,:);
q3 = q(3,:);
q4 = q(4,:);
V = [v1.*(q1.^2 + q2.^2 - q3.^2 - q4.^2) - v2.*(2.*q1.*q4 - 2.*q2.*q3) + v3.*(2.*q1.*q3 + 2.*q2.*q4);
v2.*(q1.^2 - q2.^2 + q3.^2 - q4.^2) + v1.*(2.*q1.*q4 + 2.*q2.*q3) - v3.*(2.*q1.*q2 - 2.*q3.*q4);
v3.*(q1.^2 - q2.^2 - q3.^2 + q4.^2) - v1.*(2.*q1.*q3 - 2.*q2.*q4) + v2.*(2.*q1.*q2 + 2.*q3.*q4)];
end